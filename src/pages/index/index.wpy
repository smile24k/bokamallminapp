<style lang="less">
  page{
    height: 100%;
  >.index-view{
    height: 100%;
  }
  }
</style>
<template>
  <scroll-view scroll-y scroll-with-animation @scrolltolower="scrolltolower" class="index-view" lower-threshold="200">
    <banner/>
    <repeat for="{{goodsList}}" item="item">
      <item :goodsDetail="item"/>
    </repeat>
  </scroll-view>
</template>

<script>
import wepy from 'wepy';
import constant from '@/common/constant';
import { connect } from 'wepy-redux';
import { getGoods } from '../../store/actions';
import banner from '@/components/banner';
import item from '@/components/item';

@connect(
  {
    goodsList(state) {
      return state.indexReducer.data;
    },
    hasMore(state) {
      return state.indexReducer.hasMore;
    },
    loading(state) {
      return state.indexReducer.loading;
    },
    page(state) {
      return state.indexReducer.page;
    }
  },
  {
    getGoods
  }
)
export default class Index extends wepy.page {
  onLoad() {
    this.methods.getGoods(1, 'boka');
    console.log(this);
  }
  components = {
    banner,
    item
  };

  data = {};
  methods = {
    click(e) {
      console.log(11);
      this.$broadcast('banner-broadcast', 1, 3, 4);
    },
    scrolltolower(e){
      let {page,hasMore,loading} = this;
    if(loading || !hasMore){
      return;
    }
    this.methods.getGoods(page,'boka');
    }
  };
  onReachBottom() {
    
  }
}
</script>
