<style lang="less">
  @import "./src/less/index";
</style>
<template>
  <scroll-view
    scroll-y
    scroll-with-animation
    @scrolltolower="scrolltolower"
    class="index-view"
    lower-threshold="300"
  >
    <view class='serach_wrap'>
        <view class='11' bindtap='goBoka'>
          <image class='smile' src='../../images/index_knowledge_boka.png' mode='widthFix'></image>
        </view>
        <view class='11' bindtap='bokaCallMe'>
          <image class='smile' src='../../images/index_boka_callme.png' mode='widthFix'></image>
        </view>
      </view>
    <banner/>
    <view class='category_wrap'>
        <view class='category'>
          <view class='list' wx:for="{{bokaCategory}}" wx:key="id">
            <form bindsubmit="chooseType" data-id="{{item.id}}" report-submit='true'>
                <button form-type="submit" type="default" plain='true' class="footer_list">
                  <image src="{{item.img}}"></image>
                </button>
                <text>{{item.name}}</text>
            </form>
          </view>
        </view>
      </view>
    <view class="repeat-wrap">
      <repeat for="{{goodsList}}" item="item">
        <item :goodsDetail="item"/>
      </repeat>
      <view class="clearfix"></view>
    </view>
  </scroll-view>
</template>

<script>
import wepy from 'wepy';
import constant from '@/common/constant';
import { connect } from 'wepy-redux';
import { getGoods } from '../../store/actions';
import banner from '@/components/banner';
import item from '@/components/item';

@connect(
  {
    goodsList(state) {
      return state.indexReducer.data;
    },
    hasMore(state) {
      return state.indexReducer.hasMore;
    },
    loading(state) {
      return state.indexReducer.loading;
    },
    page(state) {
      return state.indexReducer.page;
    }
  },
  {
    getGoods
  }
)
export default class Index extends wepy.page {
  onLoad() {
    this.methods.getGoods(1, 'boka');
    console.log(this);
  }
  components = {
    banner,
    item
  };

  data = {
    bokaCategory: [{ name: "自营", id: 1, img: "../../images/boka_category_2.png" }, { name: "优选", id: 2, img: "../../images/boka_category_3.png" }, { name: "订单", id: -1, img: "../../images/boka_order_icon.png" }],
  };
  methods = {
    click(e) {
      console.log(11);
      this.$broadcast('banner-broadcast', 1, 3, 4);
    },
    scrolltolower(e) {
      let { page, hasMore, loading } = this;
      if (loading || !hasMore) {
        return;
      }
      this.methods.getGoods(page, 'boka');
    }
  };
  onReachBottom() {}
}
</script>
